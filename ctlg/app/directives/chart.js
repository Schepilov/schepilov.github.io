app.service("colorService",function(){return{getMaxHue:function(){return 360},hslToHex:function(a,b,c){a/=360,b/=100,c/=100;var d,e,f;if(0===b)d=e=f=c;else{var g=function(a,b,c){return c<0?c+=1:c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a},h=c<.5?c*(1+b):c+b-c*b,i=2*c-h;d=g(i,h,a+1/3),e=g(i,h,a),f=g(i,h,a-1/3)}var j=function(a){var b=Math.round(255*a).toString(16);return 1===b.length?"0"+b:b};return"#"+j(d)+j(e)+j(f)}}}),app.directive("chart",["$timeout","$filter","colorService",function(a,b,c){var d=b("truncate");return{restrict:"A",scope:{chartType:"@",chartId:"@chart",chartData:"="},template:'<canvas id="{{chartId}}" width="100%" height="240"></canvas>',link:function(b,e){var f=[],g=[],h=[],i={responsive:!0,maintainAspectRatio:!1,legend:{position:"left",labels:{boxWidth:12}}},j=_.sortBy(b.chartData,"value");j.reverse();var k=Math.floor(c.getMaxHue()/j.length);_.each(j,function(a,b){f.push(a.value),g.push(d(a.name,24));var e=b*k;h.push(c.hslToHex(e,100,66))}),a(function(){var a=new Chart(b.chartId,{type:b.chartType,data:{datasets:[{data:f,backgroundColor:h}],labels:g},options:i});b.$watch("chartData",function(){a.update()})},100)}}}]),app.directive("groupedChart",["$timeout","$filter","$window","colorService",function(a,b,c,d){b("truncate");return{restrict:"A",scope:{chartId:"@groupedChart",chartData:"="},template:'<canvas id="{{chartId}}"></canvas>',link:function(b,e){var f={responsive:!1,maintainAspectRatio:!1,legend:{position:"top",labels:{boxWidth:12}}},g=[],h=[],i=_.pluck(b.chartData,"label"),j=1;_.each(b.chartData,function(a){a.data.length>j&&(j=a.data.length,g=_.pluck(a.data,"label"))});var k=Math.floor(d.getMaxHue()/j);_.each(g,function(a,c){var e=c*k,f={data:[],label:a,backgroundColor:d.hslToHex(e,100,66)};_.each(b.chartData,function(b){var c=_.findWhere(b.data,{label:a});c?f.data.push(c.value):f.data.push(0)}),h.push(f)}),a(function(){var a=c.document.getElementById(b.chartId);a.width=$(a).parent().width(),a.height=.5625*a.width;new Chart(a,{type:"bar",data:{datasets:h,labels:i},options:f})},100)}}}]);